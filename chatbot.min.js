document.addEventListener('DOMContentLoaded',async()=>{const e=document.getElementById('chat-widget'),t=document.getElementById('minimize-chat'),s=document.getElementById('chat-input'),a=document.getElementById('send-message'),o=document.getElementById('chat-messages');let n=!0;e.style.height='50px',t.innerHTML='<i class="fas fa-plus"></i>',t.addEventListener('click',()=>{n=!n,e.style.height=n?'50px':'500px',t.innerHTML=n?'<i class="fas fa-plus"></i>':'<i class="fas fa-minus"></i>',!n&&0===o.children.length&&setTimeout(()=>{displayMessage(`üéØ **EXCLUSIVE OFFER: FREE Google Ads + Website Audit!** üéØ\n\nHi! I'm Marlon's AI assistant, and I'm excited to offer you something special today.\n\n**Get a comprehensive audit worth $200 absolutely FREE!** I'll analyze:\n‚úÖ Your Google Ads account structure & performance\n‚úÖ Keyword targeting effectiveness  \n‚úÖ Landing page optimization opportunities\n‚úÖ Competitor analysis insights\n‚úÖ Actionable recommendations to boost ROI\n\n**No strings attached** - just pure value to help your business grow.\n\nReady to unlock your campaign's potential? Just ask me anything about Google Ads, digital marketing, or let's schedule your free audit! What's on your mind?`,'bot')},500)}),s.addEventListener('keypress',e=>{'Enter'===e.key&&!e.shiftKey&&(e.preventDefault(),handleSendMessage())}),a.addEventListener('click',handleSendMessage),setupImageViewer();let r='';const c={userIndustry:'',budgetRange:'',currentGoals:'',conversationHistory:[]};function p(e){c.conversationHistory.push(e);const t=e.toLowerCase();t.includes('e-commerce')||t.includes('local business')||t.includes('service')?c.userIndustry=e.match(/(?:e-commerce|local business|service|restaurant|retail|healthcare|consulting)/i)?.[0]||'':t.includes('$')||t.includes('budget')||t.includes('spend')?c.budgetRange=e.match(/\$?[\d,]+(?:-\$?[\d,]+)?/i)?.[0]||'':t.includes('leads')||t.includes('sales')||t.includes('brand awareness')?c.currentGoals=e.match(/(?:leads|sales|brand awareness|traffic|conversions)/i)?.[0]||'':''}const g={questions:[{id:'business_type',text:'What type of business do you have?',options:['E-commerce','Local Service Business','Consulting/Coaching','Restaurant/Food','Healthcare','Other']},{id:'budget',text:"What's your current monthly ad budget?",options:['Under $500','$500-$1,500','$1,500-$3,000','$3,000-$5,000','$5,000+','Not running ads yet']},{id:'goals',text:'What are your main advertising goals?',options:['Generate more leads','Increase online sales','Build brand awareness','Get more phone calls','Drive website traffic','All of the above']}],currentQuestion:0,answers:{},generateRecommendation(){const e=this.answers;let t='Launchpad',s=150;return('$1500-5000'===e.current_spend||'$5000+'===e.current_spend)?(t='Total Control',s=500):'$500-1500'===e.current_spend&&(t='Growth',s=300),{package:t,price:s,personalized:!0,context:e}}};function showPricingCalculator(){const e=document.createElement('div');e.className='pricing-calculator',e.innerHTML='\n        <div class="pricing-calculator">\n            <h3>üìä Interactive Pricing Calculator</h3>\n            <p>Adjust your monthly ad budget to see recommended packages:</p>\n            <div class="calculator-controls">\n                <label for="budget-slider">Monthly Ad Budget: $<span id="budget-display">1000</span></label>\n                <input type="range" id="budget-slider" min="200" max="10000" value="1000" step="100">\n            </div>\n            <div id="recommended-package" class="recommended-package">\n                <h4>Recommended: Growth Package</h4>\n                <p><strong>$300/month management fee</strong></p>\n                <p>Perfect for your $1,000 budget!</p>\n                <ul>\n                    <li>‚úÖ Advanced keyword research</li>\n                    <li>‚úÖ Weekly optimization</li>\n                    <li>‚úÖ Landing page suggestions</li>\n                    <li>‚úÖ Monthly strategy calls</li>\n                </ul>\n                <button class="quick-action" onclick="bookConsultation()">Book Free Consultation</button>\n            </div>\n        </div>\n    ',displayMessage('Here\'s your personalized pricing calculator! üí∞','bot'),displayMessage(e.innerHTML,'bot');const t=document.getElementById('budget-slider'),s=document.getElementById('budget-display'),a=document.getElementById('recommended-package');t&&s&&a&&t.addEventListener('input',()=>{const e=parseInt(t.value);s.textContent=e;let o,n;e<500?(o='Launchpad',n=150):e<1500?(o='Growth',n=300):(o='Total Control',n=500);let r=`<h4>Recommended: ${o} Package</h4><p><strong>$${n}/month management fee</strong></p><p>Perfect for your $${e} budget!</p>`;r+='Launchpad'===o?'<ul><li>‚úÖ Basic search campaign</li><li>‚úÖ Keyword research (25 keywords)</li><li>‚úÖ Bi-weekly monitoring</li><li>‚úÖ Monthly reports</li></ul>':'Growth'===o?'<ul><li>‚úÖ Advanced keyword research</li><li>‚úÖ Weekly optimization</li><li>‚úÖ Landing page suggestions</li><li>‚úÖ Monthly strategy calls</li></ul>':'<ul><li>‚úÖ Multiple campaign types</li><li>‚úÖ Advanced targeting</li><li>‚úÖ Daily optimization</li><li>‚úÖ Priority communication</li></ul>',r+='<button class="quick-action" onclick="bookConsultation()">Book Free Consultation</button>',a.innerHTML=r})}function startServiceDiscovery(){g.currentQuestion=0,g.answers={};const e=g.questions[g.currentQuestion];let t=`<div class="service-discovery"><h3>üéØ Let's find your perfect package!</h3><p>${e.text}</p><div class="discovery-options">`;e.options.forEach((s,a)=>{t+=`<button class="discovery-option" onclick="selectDiscoveryOption('${e.id}','${s}')">${s}</button>`}),t+='</div></div>',displayMessage("Let's personalize your Google Ads strategy! üöÄ",'bot'),displayMessage(t,'bot')}function selectDiscoveryOption(e,t){g.answers[e]=t,g.currentQuestion++;const s=g.questions[g.currentQuestion];if(s){let e=`<div class="service-discovery"><h3>Question ${g.currentQuestion+1} of ${g.questions.length}</h3><p>${s.text}</p><div class="discovery-options">`;s.options.forEach((t,a)=>{e+=`<button class="discovery-option" onclick="selectDiscoveryOption('${s.id}','${t}')">${t}</button>`}),e+='</div></div>',displayMessage(e,'bot')}else{const e=g.generateRecommendation();let t=`<div class="recommendation-result"><h3>üéâ Your Personalized Recommendation</h3><div class="package-card"><h4>${e.package} Package</h4><p class="price">$${e.price}/month</p><p>Based on your responses, this is the perfect fit for your business!</p>`;t+='Launchpad'===e.package?'<ul><li>‚úÖ Perfect for starting out</li><li>‚úÖ Essential campaign setup</li><li>‚úÖ Bi-weekly optimization</li></ul>':'Growth'===e.package?'<ul><li>‚úÖ Advanced optimization</li><li>‚úÖ Weekly monitoring</li><li>‚úÖ Landing page guidance</li></ul>':'<ul><li>‚úÖ Complete campaign management</li><li>‚úÖ Daily optimization</li><li>‚úÖ Priority support</li></ul>',t+='<div class="recommendation-actions"><button class="quick-action" onclick="bookConsultation()">Book Free Strategy Call</button><button class="quick-action" onclick="showPricingCalculator()">View All Packages</button></div></div></div>',displayMessage(t,'bot')}}function bookConsultation(){displayMessage("üóìÔ∏è Let's schedule your free strategy call!",'bot'),displayMessage('I\'m connecting you with Marlon\'s calendar for a <strong>free 30-minute strategy call</strong>. This is where we\'ll dive deep into your Google Ads challenges and create a custom action plan.\n\n<a href="https://calendar.app.google/ecrh372MbNbBHbSf6" target="_blank" class="quick-action" style="display:inline-block;margin:10px 0;">üìÖ Book Your Free Call Now</a>\n\nDuring this call, we\'ll cover:\n‚úÖ Your current Google Ads performance\n‚úÖ Quick wins you can implement immediately\n‚úÖ Custom strategy recommendations\n‚úÖ Package recommendations based on your goals\n\n<em>No obligation - just pure value to help your business grow!</em>','bot')}function showEmailCapture(){displayMessage("üìß Get your free Google Ads checklist!",'bot'),displayMessage('<div class="email-capture">\n    <h4>üéØ Free Google Ads Audit Checklist</h4>\n    <p>Get Marlon\'s exclusive 15-point checklist that he uses to audit Google Ads accounts worth $10K+ per month!</p>\n    <form onsubmit="submitEmail(event)">\n        <input type="email" id="email-input" placeholder="Enter your email" required>\n        <button type="submit" class="quick-action">Send My Checklist</button>\n    </form>\n    <p><small>100% free. Unsubscribe anytime. No spam ever.</small></p>\n</div>','bot')}function submitEmail(e){e.preventDefault();const t=document.getElementById('email-input').value;displayMessage(`‚úÖ Checklist sent to ${t}!`,'bot'),displayMessage('Perfect! Your Google Ads audit checklist is on its way.\n\nWhile you wait, here\'s a quick preview of what\'s inside:\n\n1Ô∏è‚É£ **Account Structure Analysis**\n2Ô∏è‚É£ **Keyword Performance Review**\n3Ô∏è‚É£ **Ad Copy Optimization Tips**\n4Ô∏è‚É£ **Landing Page Checklist**\n5Ô∏è‚É£ **Conversion Tracking Setup**\n\nReady to take the next step? Let\'s discuss your specific challenges!','bot')}async function loadPortfolioData(){try{const e=await fetch('knowledge_base.md');if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);r=await e.text()}catch(e){console.error('Error loading knowledge base:',e);r='# Comprehensive Knowledge Base - Marlon Palomares Portfolio & Google Ads Expertise\n\n## Personal Information & Portfolio Overview\n\n**Name:** Marlon Palomares  \n**Title:** Google Ads Specialist  \n**Email:** Mpalomaresdigital@gmail.com  \n**Website:** https://mpalomaresdigitalsolutions.github.io/MPDIGITAL/\n\n### Professional Summary\nA results-driven Google Ads specialist with hands-on campaign management experience, trained by Ian Baillo, the Philippines\' top Google Ads expert. Currently managing a $10,000 monthly search campaign for a nonprofit through VolunteerMatch. Over 4 years of experience with US-based clients as a Customer Service and Technical Support Representative.\n\n### Core Services Offered\n1. **Google Ads Audit** - Comprehensive analysis and optimization recommendations\n2. **Google Ad Strategy** - Strategic planning and campaign development\n3. **Google Ads Optimization** - Performance improvement and ROI maximization\n4. **Copywriting** - Ad copy development and optimization\n5. **Keyword Research** - Target audience and keyword analysis\n6. **Conversion Tracking Setup** - Advanced tracking implementation\n\n### Service Packages & Pricing\n\n#### The \'Launchpad\' Package - $150/month\n**Target:** Small business with $200-$500 monthly ad budget\n**Includes:**\n- One Google Search campaign setup\n- Keyword research (up to 25 keywords)\n- 3-5 high-quality ad creatives\n- Initial conversion tracking setup\n- Bi-weekly campaign monitoring and budget management\n- Negative keyword research\n- Ad copy A/B testing\n- Basic bid adjustments\n- Bi-weekly email updates and monthly performance summary\n\n#### The \'Growth\' Package - $300/month\n**Target:** Growing business with $500-$1,500 monthly ad budget\n**Includes:**\n- Everything in Launchpad package\n- Additional campaign setup (Display or Remarketing)\n- Advanced keyword and audience research\n- Weekly optimization and aggressive bid strategies\n- Landing page suggestions\n- Weekly performance reports\n- Monthly strategy call\n\n#### The \'Total Control\' Package - $500+/month\n**Target:** Established business with $1,500+ monthly ad budget\n**Includes:**\n- Everything in Growth package\n- Multiple campaign types (Search, Display, Shopping, Video)\n- Comprehensive audience targeting and segmentation\n- Advanced conversion tracking with Google Analytics\n- Full-service landing page consultation\n- Daily/Bi-weekly budget and bid monitoring\n- Custom weekly and monthly reports\n- Priority communication\n\n### Key Achievements & Experience\n- **Current:** Managing $10,000/month Google Ads campaign for nonprofit\n- **Training:** Advanced Google Ads training from Ian Baillo (Philippines\' top expert)\n- **Certification:** Google Ads certified with advanced optimization training\n- **Experience:** 4+ years with US-based clients in customer service and technical support\n- **Performance:** 78.5% optimization score, $5.39 average cost per conversion, 15+ conversions generated\n\n### Contact & Scheduling\n**Booking Link:** https://calendar.app.google/ecrh372MbNbBHbSf6  \n**Email:** Mpalomaresdigital@gmail.com  \n**Availability:** Free strategy calls available for qualified prospects'}console.log('Knowledge base loaded successfully.')}function displayMessage(e,t){const s=document.createElement('div');s.classList.add('chat-message',`${t}-message`),s.innerHTML=e.replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>'),o.appendChild(s),o.scrollTop=o.scrollHeight}function typeMessage(e,t){const s=document.createElement('div');s.classList.add('chat-message',`${t}-message`),o.appendChild(s);let a=0;const n=20;!function t(){if(a<e.length){const o=e[a];'\n'===o?s.innerHTML+='<br>':'*'===o&&'*'===e[a+1]?(s.innerHTML+=`<strong>${e.substring(a+2,e.indexOf('**',a+2))}</strong>`,a=e.indexOf('**',a+2)+1):'*'===o&&'*'!==e[a+1]?(s.innerHTML+=`<em>${e.substring(a+1,e.indexOf('*',a+1))}</em>`,a=e.indexOf('*',a+1)+1):s.innerHTML+=o,a++,o.scrollTop=o.scrollHeight,setTimeout(t,n)}}()}function setupImageViewer(){const e=document.createElement('div');e.innerHTML='\n            <div id="image-lightbox" class="image-lightbox" style="display: none;">\n                <div class="lightbox-content">\n                    <span class="lightbox-close">&times;</span>\n                    <img class="lightbox-image" src="" alt="">\n                    <div class="lightbox-caption"></div>\n                </div>\n            </div>\n        ',document.body.appendChild(e.firstElementChild);const t=document.getElementById('image-lightbox'),s=document.querySelectorAll('.ghl-image-preview'),a=document.querySelector('.lightbox-close'),o=document.querySelector('.lightbox-image'),n=document.querySelector('.lightbox-caption');s.forEach(e=>{e.addEventListener('click',e=>{const s=e.target.dataset.fullsize||e.target.src,a=e.target.dataset.caption||e.target.alt;o.src=s,n.textContent=a,t.style.display='flex'})}),a.addEventListener('click',()=>t.style.display='none'),t.addEventListener('click',e=>{e.target===t&&(t.style.display='none')})}async function handleSendMessage(){const e=s.value.trim();if(!e)return;displayMessage(e,'user'),s.value='',s.disabled=!0,a.disabled=!0;try{const t=await fetch('https://mpalomaresdigitalsolutions.netlify.app/.netlify/functions/deepseek',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:e,context:r})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const{response:s}=await t.json();typeMessage(s,'bot')}catch(e){console.error('Error:',e);let response;const messageLower=e.toString().toLowerCase();if(messageLower.includes('google ads')||messageLower.includes('campaign')){response=`I understand you're asking about Google Ads! Based on Marlon's current work managing a $10K/month campaign for a nonprofit, here's what's working:`}else if(messageLower.includes('price')||messageLower.includes('cost')||messageLower.includes('pricing')){response=`üí∞ **Here's Marlon's complete pricing structure:**\n\n**üöÄ Launchpad Package - $150/month**\nPerfect for small businesses with $200-$500 ad budgets\n\n**üìà Growth Package - $300/month** \nIdeal for growing businesses with $500-$1,500 budgets\n\n**üéØ Total Control Package - $500+/month**\nComplete management for established businesses with $1,500+ budgets\n\nWould you like to see the interactive pricing calculator to find your perfect match? Just type "calculator" or click below:`,setTimeout(()=>{displayMessage('<button class="quick-action" onclick="showPricingCalculator()">üìä Interactive Pricing Calculator</button>','bot')},1000)}else if(messageLower.includes('audit')||messageLower.includes('review')){response=`üîç **Marlon offers comprehensive Google Ads audits!**\n\nHis audit includes:\n‚úÖ Account structure analysis\n‚úÖ Keyword performance review\n‚úÖ Ad copy optimization\n‚úÖ Landing page recommendations\n‚úÖ Competitor analysis\n‚úÖ Actionable improvement plan\n\n**Best part?** The audit fee is credited towards any package if you decide to work together!\n\nWant to schedule a free audit? Type "audit" or click below:`,setTimeout(()=>{displayMessage('<button class="quick-action" onclick="bookConsultation()">üéØ Free Audit Consultation</button>','bot')},1000)}else{response="I'm here to help! I can assist you with:\n\nüìä **Pricing Calculator** - Find your perfect package\nüéØ **Free Strategy Call** - Book with Marlon directly\nüìß **Free Checklist** - Google Ads audit checklist\n\nWhat would you like to explore first?"}typeMessage(response,'bot')}finally{s.disabled=!1,a.disabled=!1,s.focus()}}loadPortfolioData(),setTimeout(()=>{displayMessage("Hello! I am Marlon's chatbot. How can I help you today?",'bot')},800),window.showPricingCalculator=showPricingCalculator,window.startServiceDiscovery=startServiceDiscovery,window.bookConsultation=bookConsultation,window.showEmailCapture=showEmailCapture,window.selectDiscoveryOption=selectDiscoveryOption,window.submitEmail=submitEmail;const chatKeywords={price:'showPricingCalculator',pricing:'showPricingCalculator',cost:'showPricingCalculator',calculator:'showPricingCalculator',audit:'bookConsultation',review:'bookConsultation',consultation:'bookConsultation',strategy:'startServiceDiscovery',discovery:'startServiceDiscovery',checklist:'showEmailCapture',email:'showEmailCapture'};s.addEventListener('keypress',e=>{if('Enter'===e.key&&!e.shiftKey){const t=s.value.trim().toLowerCase();for(const[s,a]of Object.entries(chatKeywords))if(t.includes(s)){e.preventDefault(),s.value='';const o=window[a];return'function'==typeof o?(o(),void e.preventDefault()):void 0}}})});